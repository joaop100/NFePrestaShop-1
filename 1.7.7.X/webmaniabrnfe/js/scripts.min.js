jQuery(document).ready(function(){function e(e){var a=!1;return e.val().trim()||(a=!0),a}function a(e,a){"error"==a?e.parent(".form-group").removeClass("form-ok").addClass("form-error"):"success"==a&&e.parent(".form-group").removeClass("form-error").addClass("form-ok")}function r(e){var r=!0;return e.forEach(function(e,n){if("cpfValue"==e){var t=$('input[name="cpfValue"]');s(t.val())||(r=!1,a(t,"error"))}else if("cnpjValue"==e){var t=$('input[name="cnpjValue"]');o(t.val())||(r=!1,a(t,"error"))}else{var t=$('input[name="'+e+'"]');t.val().trim()||(r=!1,a(t,"error"))}}),r}function s(e){$return=!0,e=e.replace("-",""),e=e.replace(/\./g,"");var a=["11111111111","22222222222","33333333333","44444444444","55555555555","66666666666","77777777777","88888888888","99999999999","00000000000"];for(i=0;i<a.length;i++)a[i]==e&&($return=!1);for(add=0,i=0;i<9;i++)add+=parseInt(e.charAt(i),10)*(10-i);for(rev=11-add%11,(10==rev||11==rev)&&(rev=0),rev!=parseInt(e.charAt(9),10)&&($return=!1),add=0,i=0;i<10;i++)add+=parseInt(e.charAt(i),10)*(11-i);return rev=11-add%11,(10==rev||11==rev)&&(rev=0),rev!=parseInt(e.charAt(10),10)&&($return=!1),$return}function o(e){if(e=e.replace(/[^\d]+/g,""),""==e)return!1;if(14!=e.length)return!1;if("00000000000000"==e||"11111111111111"==e||"22222222222222"==e||"33333333333333"==e||"44444444444444"==e||"55555555555555"==e||"66666666666666"==e||"77777777777777"==e||"88888888888888"==e||"99999999999999"==e)return!1;for(tamanho=e.length-2,numeros=e.substring(0,tamanho),digitos=e.substring(tamanho),soma=0,pos=tamanho-7,i=tamanho;i>=1;i--)soma+=numeros.charAt(tamanho-i)*pos--,pos<2&&(pos=9);if(resultado=soma%11<2?0:11-soma%11,resultado!=digitos.charAt(0))return!1;for(tamanho+=1,numeros=e.substring(0,tamanho),soma=0,pos=tamanho-7,i=tamanho;i>=1;i--)soma+=numeros.charAt(tamanho-i)*pos--,pos<2&&(pos=9);return resultado=soma%11<2?0:11-soma%11,resultado!=digitos.charAt(1)?!1:!0}function n(){var e='<div class="person-type-fields"><div class="clearfix"><label>Tipo de pessoa:</label><br/><div class="radio-inline"><label class="top"><span><input type="radio" name="person_type" class="radio-cpf" data-rel="cpf" value="1" checked/></span>Pessoa Física</label></div><div class="radio-inline"><label class="top"><span><input type="radio" name="person_type" class="radio-cnpj" data-rel="cnpj" value="2"/></span>Pessoa Jurídica</label></div></div><div id="cpf-field" class="form-group active"><label>CPF <sup>*</sup></label><input type="text" class="form-control" name="cpfValue" id="cpf-input"/></div><div id="cnpj-field" style="display:none"><div class="form-group"><label>CNPJ <sup>*</sup></label><input type="text" class="form-control" name="cnpjValue" id="cnpj-input"/></div><div class="form-group"><label>Inscrição estadual <sup>*</sup></label><input type="text" class="form-control" name="ieValue" id="ie-input"/></div><div></div>',a='<div class="form-group county"><label>Bairro <sup>*</sup></label><input type="text" class="form-control" name="county"/></div>',r='<div class="form-group number"><label>Número <sup>*</sup></label><input type="text" class="form-control" name="address_number"</div>',s='<div id="correios-loading"></div>';return{extraDocs:e,extraCounty:a,extraAddressNumber:r,loading:s}}function t(){var e=n();p()&&($(e.extraDocs).prependTo("#add_address"),$(e.loading).appendTo("#add_address")),$(e.extraAddressNumber).insertAfter($("#address1").parent(".form-group")),$("#postcode").parent(".form-group").insertAfter($("#company").parent(".form-group"))}function d(){if(0!=$('#add_address input[name="id_address"]').val()){var e=$('#add_address input[name="id_address"]').val();$.ajax({type:"POST",async:!1,url:baseDir+"modules/webmaniabrnfe/ajax.php",data:{method:"myMethod",addressID:e},success:function(e){console.log(e),result=$.parseJSON(e),$('input[name="address_number"]').val(result[0].nfe_number),p()&&l(result)}})}}function u(){$("#cpf-input").mask("999.999.999-99"),$("#cnpj-input").mask("99.999.999/9999-99")}function l(e){2==e[0].nfe_tipo_pessoa?($(".radio-cnpj").prop("checked",!0),$('input[name="cnpjValue"]').val(e[0].nfe_cnpj),$('input[name="ieValue"]').val(e[0].nfe_ie),$("#cnpj-field").addClass("active").css("display","block"),$("#cpf-field").css("display","none").removeClass("active")):$('input[name="cpfValue"]').val(result[0].nfe_cpf),"boolean"==typeof mask_doc_fields&&u()}function p(){return"boolean"==typeof add_person_fields?!0:!1}function c(){return"boolean"==typeof mask_doc_fields?!0:!1}function f(){return"boolean"==typeof auto_address_fill?!0:!1}var m=$("body#address");m.length>0&&(t(),d(),c()&&u(),f()&&(correios.init("qS4SKlmAXR21h7wrBMcs0SZyXauLqo5m","nkKkInYJ5QvogYn1xj4lk7w3hkhA8qzruoKzuLf6UyBtSIJL"),$("#postcode").correios("#address1","#address2","#city","#id_state","#correios-loading")),p()&&($(document).on("change",'.person-type-fields input[name="person_type"]',function(){console.log($(this).val());var e=$(this).attr("data-rel"),a=$("#"+e+"-field");a.hasClass("active")||$(".person-type-fields").find(".active").removeClass("active").fadeToggle("fast","swing",function(){a.fadeToggle().addClass("active")})}),$(document).on("focusout",'input[name="cpfValue"]',function(){s($(this).val())?$(this).parent(".form-group").removeClass("form-error").addClass("form-ok"):$(this).parent(".form-group").removeClass("form-ok").addClass("form-error")}),$(document).on("focusout",'input[name="cnpjValue"]',function(){o($(this).val())?$(this).parent(".form-group").removeClass("form-error").addClass("form-ok"):$(this).parent(".form-group").removeClass("form-ok").addClass("form-error")})),$('input[name="address_number"]').keyup(function(){this.value=this.value.replace(/[^0-9\.]/g,"")}),$('input[name="ieValue"]').keyup(function(){this.value=this.value.replace(/[^0-9\.]/g,"")}),$(document).on("focusout",'input[name="address_number"]',function(){e($(this))===!0?a($(this),"error"):a($(this),"success")}),$(document).on("focusout",'input[name="address2"]',function(){e($(this))===!0?a($(this),"error"):a($(this),"success")}),$("#submitAddress").on("click",function(e){var a=["address_number","address2"];if(p()){var s=$('input[name="person_type"]:checked').val();1==s?a.push("cpfValue"):2==s&&(a.push("cnpjValue"),a.push("company"),a.push("ieValue"))}r(a)===!1&&($(window).scrollTo("#add_address"),e.preventDefault())}))});
